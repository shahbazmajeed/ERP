{% extends "layout.html" %}
{% load dynamic_attr %}
{% block title %}Manage Database{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">ðŸ“‹ Manage Database</h2>

  <!-- Select Model -->
  <form method="get" class="row mb-4 justify-content-center">
    <div class="col-md-6">
      <label class="form-label">Select Table</label>
      <select name="model" class="form-select" onchange="this.form.submit()" required>
        <option value="">-- Choose a model --</option>
        {% for m in model_names %}
          <option value="{{ m }}" {% if selected_model == m %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  {% if model_data %}
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="model" value="{{ selected_model }}">
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-dark text-white d-flex justify-content-between">
        <strong>{{ selected_model }}</strong>
        <button type="submit" name="delete_selected" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete selected entries?')">Delete Selected</button>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-bordered table-sm align-middle text-center">
          <thead class="table-light">
            <tr>
              <th><input type="checkbox" onclick="toggleAll(this)"></th>
              {% for field in model_data.fields %}
                <th>{{ field|capfirst }}</th>
              {% endfor %}
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for obj in model_data.objects %}
              <tr>
                <td><input type="checkbox" name="selected_ids" value="{{ obj.pk }}"></td>
                {% for field in model_data.fields %}
                  <td>{{ obj|attr:field }}</td>
                {% endfor %}
                <td>
                  <a href="{% url 'edit_entry' model=selected_model pk=obj.pk %}" class="btn btn-sm btn-warning">Edit</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </form>
  {% elif selected_model %}
    <div class="alert alert-warning text-center">No records found for model <strong>{{ selected_model }}</strong>.</div>
  {% endif %}
</div>

<script>
  function toggleAll(source) {
    const checkboxes = document.querySelectorAll('input[name="selected_ids"]');
    checkboxes.forEach(cb => cb.checked = source.checked);
  }
</script>
{% endblock %}
